# 编译原理

## 1 绪论

### 1.1 什么是编译

- 编译就是将**高级语言（源语言）**翻译成**汇编语言或机器语言（目标语言）**的过程
- 预处理器
- 编译器
- 汇编器
- 链接器/加载器



### 1.2 编译系统的结构

- 词法分析
- 语法分析
- 语义分析
- 中间代码生成
- 优化
- 目标代码生成



### 1.3 词法分析概述

从**源程序**中：识别**单词**，确定类型，生成***token***



### 1.4 语法分析概述

从***token*序列**中：识别**短语**，构造语法分析树



### 1.5 语义分析概述

收集标识符属性信息，形成**符号表**；**语义检查**



### 1.6 中间代码生成及编译

- 生成中间表示形式（常用**三地址码**）
- **优化**并生成**目标机器语言**



## 2 程序设计语言及其文法

### 2.1 字母表和串

- **字母表**及其乘积、幂、闭包等运算
- **串**及其连接、幂等运算



### 2.2 文法的定义

文法是一个具有**推导**和**规约**功能的**四元组**：

- **终结符集**（$V_T$）
- **非终结符集**（$V_N$）
- **产生式集**（$P$）
- **开始符号**（$S$）



### 2.3  语言的定义

由文法**开始符号**推导出的所有**句子**构成的集合称为**文法生成的语言**。

文法解决了**无穷语言的有穷表示**问题。

语言有并、连接、幂、闭包等运算。



### 2.4 文法的分类

> 从上至下，要求依次累加

- 无限制文法/短语结构文法
  - 产生式**左部**至少包含一个**非终结符**
- 上下文有关文法
  - 产生式**左部长度小于右部**
- 上下文无关文法
  - 产生式**左部仅为非终结符**
- 正则文法
  - 仅允许**左线性**或**右线性**



### 2.5 CFG的分析树

- 分析树是**推导**的图形化表示：
  - 根节点：文法**开始符号**
  - 内部结点：**产生式**
    - *左部**：该节点**
    - 右部**：子结点从左到右
  - 叶结点：非终结符或终结符
  - **树的产出/边缘**：从左到右排列叶节点
- 短语：分析树中每一棵**子树的边缘**
- 二义性文法与消歧规则



## 3 词法分析

### 3.1 正则表达式

- 正则表达式是描述**正则语言**的**更紧凑**的表示方法
- 它可以**递归构建**
- 与**正则文法**等价
- 有自己的**代数定律**



### 3.2 有穷自动机

> 核心就是：`状态 + 输入 + 转换`

- 有穷自动机（FA）：

  - 一种处理系统的数学模型。这种处理系统由**输入带、读头、有穷控制器**构造，可以根据当前**状态**和**输入**转入下一状态。
  - FA有其定义/接收的**语言**
  - FA遵循最长子串匹配

- DFA：一种代表FA模型的**五元组**

  - **有穷状态集**（$S$）

  - **输入字母表**（$\Sigma$）

    > $\epsilon\notin\Sigma$

  - **转换函数**（$\sigma$）：$S\times\Sigma\rarr S$

  - **开始状态**（$s_0$）

  - **接收状态**（$F$）

- NFA：一种代表FA模型的**五元组**

  - **有穷状态集**（$S$）

  - **输入字母表**（$\Sigma$）

  - **转换函数**（$\sigma$）：$S\times\Sigma\rarr 2^S$

    > $\epsilon-NFA$与$NFA$的区别就在于转换函数：$S\times(\Sigma\cup\{\epsilon\})\rarr 2^S$

  - **开始状态**（$s_0$）

  - **接收状态集合**（$F$）

### 3.3 RE与FA的转换

- RE$\rarr$NFA：**分解、递归**
  - RE与NFA的对应规则
- NFA$\rarr$DFA：**状态转换表**
  - 子集构造法

### 3.4 识别单词的DFA

- 识别**标识符的**DFA
- 识别**无符号数**的DFA
- 识别**各进制无符号整数**的DFA
- 识别**注释**的DFA
- 识别**各类单词**的DFA

### 3.5 词法分析阶段的错误处理

- 错误类型
  - **单词拼写**错误
  - **非法字符**
- **错误处理程序**
  - 调用时机：**当前状态与当前输入信息为空**
  - 处理方式：查找已扫描字符串的最后一个**终态字符**
    - 找到了：识别成一个**单词**，回到初态
    - 没找到：错误恢复策略（**恐慌模式**）



## 4 语法分析

### 自顶向下分析

- 1 概述

  自顶向下构造语法分析树，每次用最左非终结符（树的最左非终结符节点），根据输入符，选择其合适的产生式，进行替换（生成子节点）
  一般的自顶向下分析往往会因为产生式选择的不确定性而需要回溯，但预测分析就不需要回溯，是一种确定的自顶向下分析方法
  
- 2 文法转换

  并不是所有文法都直接适用于自顶向下的分析，文法转换就是要改造这些文法以使其适合自顶向下的分析。
  常见的文法就是消除左递归，因为左递归会导致无限递归。
  提取左公因子也是一种文法转换方式，本质是在推迟决定。
  
### 预测分析

- 1 LL(1)文法

  预测分析是确定的自顶向下分析，每次候选的产生式是唯一的。
  预测分析需要满足特定规则的文法：
  S_文法是满足要求的，但它的限制较强；
  为此，我们可以放宽限制，得到q_文法；
  q_文法的限制可以继续放宽，最终得到LL(1)文法
  在这个放宽限制的过程中，定义了许多新的概念，方便对文法的描述
  
- 2 FIRST集和FOLLOW集的计算

## 5 语法制导翻译

## 6 中间代码生成

## 7 运行存储分配

## 8 代码优化

## 9 代码生成

