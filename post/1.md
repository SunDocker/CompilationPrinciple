## 1 绪论

### 1.1 编译相关的概念

-   编译的概念
    -    编译就是将高级语言(**源语言**)翻译成汇编语言或机器语言(**目标语言**)的过程

-   三种程序
    -   **翻译**程序(**Translator**)： 将某一种语言描述的程序(Source Program)翻译成等价的另一种语言描述的程序(Object Program)的程序
    
        -   翻译程序-**解释**程序(**Interpreter**)：一边解释一边执行的**翻译程序**
    
            >   类似生活中的“口译”
    
        -   翻译程序-**编译**程序(**Compiler**)：将源程序完整地转换成机器语言程序或汇编语言程序，然后再处理、执行的**翻译程序**

### 1.2 编译系统的结构

-   编译系统的构成
    -   **编译程序**
        -   预处理器
        -   编译器
        -   汇编器
        -   链接器/加载器
    -   运行系统

-   编译器的8个模块
    
    ```
                                            |
                                            |SourceProgram
                                            V
        ------------                ----------------                  ------------
        |          |<-------------->|LxicalAnalyzer|<---------------->|          |
        |          |                ----------------                  |          |
        |          |                        |                         |          |
        |          |                        |Tokens                   |          |
        |          |                        V                         |          |
        |          |                    --------                      |          |
        |          |<------------------>|Parser|<-------------------->|          |
        |          |                    --------                      |          |
        |          |                        |                         |          |
        |          |                        |GrammarticalUnit         |          |
        |          |                        V                         |          |
        |   Form   |   --------------------------------------------   |  Error   |
        |Management|<->|SemanticAnalyzer IntermediateCodeGenerator|<->|Management|
        |          |   --------------------------------------------   |          |  
        |          |                        |                         |          |
        |          |                        |IntermediateCode         |          |
        |          |                        V                         |          |
        |          |                 ---------------                  |          |
        |          |<--------------->|CodeOptimizer|<---------------->|          |
        |          |                 ---------------                  |          |
        |          |                        |                         |          |
        |          |                        |IntermediateCode         |          |
        |          |                        V                         |          |
        |          |              ---------------------               |          |
        |          |<------------>|ObjectCodeGenerator|<------------->|          |
        ------------              ---------------------               ------------
                                            |
                                            |ObjectCode
                                            V
    ```
    
    -   分析
        1.  词法分析（lexical analyzer/scanner）
        2.  语法分析（syntax analyzer/parser）
        3.  语义分析
    -   综合
        1.  中间代码生成
        2.  代码优化
        3.  目标代码生成
    -   辅助
        1.  表格管理/符号表管理
        2.  出错处理

### 1.3 词法分析概述

-   功能
    -   生成token：词法分析器扫描源程序字符串，识别**单词**，确定类型，生成单词(***token***)串
        -   token：**(种别码, 属性值)**序对
    -   表格管理：登记标识符
    -   错误管理：查词法错误

-   输入与输出
    -   输入：源程序字符串
    -   输出：token序列

### 1.4 语法分析概述

-   功能
    -   token：从***token***序列**中，识别**语法成分**/**短语**，构造**语法分析树**，指导**翻译过程
        -   用token组成各类**语法成分/短语**：表达式、因子、项、语句、子程序…
            
            >    “组词成句”
    -   错误管理：指出**语法错误**
    
-   输入与输出
    -   输入：token序列
    -   输出：语法分析树（包括**语法成分**）

### 1.5 语义分析概述

-   功能
    -   语法分析树：根据语法分析树，分析由语法分析器识别出来的**语法成分的语义**
        -   语义分析一般和语法分析同时进行，称为**语法制导翻译(syntax-directed translation)**
    -   表格管理：收集**标识符**属性信息，完善**符号表**；进行子程序和变量的**静态绑定**
        -   属性信息：值、类型、作用域、...
        -   子程序：代码的相对地址
        -   变量：数据的相对地址
    -   错误管理：**语义检查**

-   输出与输出
    -   输入：语法分析树（包括**语法成分**）
    -   输出：语法分析树（包括**语法成分**）

### 1.6 中间代码生成及编译

-   功能：

    -    生成与机器无关、易于优化与转化的中间表示形式（常用**三地址码**）

         >   三地址码又有多种表示形式，其中**四元式**较为常用
         >
         >   中间代码的**优点**：
         >
         >   -   方便通过中间表示形式进行**代码优化**
         >
         >   -   方便源程序的跨平台**移植**

-   输入与输出
    -   输入：语法分析树（包括**语法成分**）
    -   输出：中间表示形式（常用**三地址码**）

### 1.7 代码优化

-   功能
    -    通过**等价**程序变换对中间代码进行优化，使程序更有效利用机器资源，节省**存储空间**，提高**运行速度**和效率

-   优化方式
    -   与机器无关的优化
        -   局部优化
            -   常数合并
            -   公共子表达式提取
        -   循环优化
            -   强度削减
            -   代码外提
    -   与机器有关的优化
        -   寄存器的利用
        -   体系结构
        -   存储策略
        -   任务划分

### 1.8 目标代码生成

-   功能：将**中间代码**转换成**目标机**上的机器指令代码或汇编代码

    >   目标代码的形式：
    >
    >   -   具有**绝对地址**的机器指令
    >   -   模块结构的机器指令（需要**链接程序**）
    >   -   汇编语言

-   输入与输出
    -   输入：中间表示形式（常用**三地址码**）
    -   输出：目标代码（一般为汇编语言）

### 1.8 表格管理

管理各种**符号**和**符号表**，辅助语法检查、语义检查，完成静态绑定，为编译的各个阶段提供信息

### 1.9 错误管理

进行各种错误的检查、报告、纠正，以及相应的**续编译处理**

### 1.10 编译程序的组织与生成

*编译程序设计的目标：*

-   程序本身：
    -    规模小、速度快、诊断能力强、可移植性好，可扩充性好

-   目标程序：
    -    规模小、速度快

---

*前端与后端：*

-   前端：
    -    与源语言有关、与目标机无关

         >   词法分析、语法分析、语义分析与中间代码生成、与机器无关的代码优化

-   后端：
    -    与目标机有关的部分

         >   与机器有关的代码优化、目标代码生成

*编译器的实现与T形图：*

-   编译器的实现思想：
    -    自展：先实现**语言子集**编译器，再用子集编译更大的集合，直至整个语言

-   T形图：
    -   内容：描述了**源语言**经编译程序到**目标语言**的过程
        ```
         --------------------------------              
         |SourceLanguage  ObjectLanguage|                
         ---------                -------           
                 |CompilingProgram|
                 ------------------
        ```
        
        >   **编译程序(CompilingProgram)的实现语言**可以是高级语言、汇编语言、机器语言，但终究只有**用机器语言实现**才能运行该程序
        
    -   作用：T形图可以直观描述语言**移植**、**新语言编译**等问题
