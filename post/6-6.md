### 6.5 过程调用语句的翻译

*主要任务：*

-   解析过程调用的参数，生成**设置实参和调用过程**的三地址码

---

*过程调用语句的代码结构：*

-   语句模式：`id(E1, E2, ..., En)`

-   代码流程

    -   运算各表达式的三地址码，计算参数值：

        ```
        id(
        	E1.code,
        	E2.code,
        	...
        	En.code
        )
        ```
    
    -   通过`param`指令将各表达式的值作为函数的实参：
    
        ```
        param E1.addr
        param E2.addr
        ...
        param En.addr
        ```

        >   这种是`param`指令集中的形式。也可以让`param Ek.addr`指令紧跟在`Ek.code`后面，就是分散形式。
        >
        >   分散形式下，需要使用一种数据结构（通常是队列`q`）来存放`Ek.addr`，以便集中生成`param`指令

    -   调用函数：`call id.addr n`
    
        >   `n`代表参数个数

---

*过程调用语句的SDT：*

-   文法符号与属性
    -   `S`：文法开始符号/过程调用代码结构
    -   `Elist`：参数列表
    -   `E`：参数表达式
        -   `E.addr`：表达式**值的存放地址**

-   副作用
    -   `gen(code)`

-   语法规则和语义动作
    -   文法开始/形成**过程调用**框架：$S\rarr call~id(Elist)\{a_1\}$
        $$
        \begin{align} &a_1:\{\\ &~~~~n=0;\\ &~~~~for~q中的每个t~do\\ &~~~~~~~~gen(param~t);\\ &~~~~~~~~n=n+1;\\ &~~~~gen(call~id.addr,n);\\ &\}\\ \end{align}
        $$
        
        >   过程调用框架形成后，根据队列`q`集中生成所有**设置实参**的`param`三地址指令，最后再生成一条**过程调用**的三地址指令
        
    -   形成**参数列表**
        -   $Elist\rarr E\{a_1\}$
            $$
            \begin{align} &a_1:\{\\ &~~~~将q初始化为只包含E.addr的队列;\\ &\}\\ \end{align}
            $$
        
            >   参数列表开始形成时初始化队列`q`
    
        -   $Elist\rarr Elist_1,E\{a_1\}$
            $$
            \begin{align} &a_1:\{\\ &~~~~将E.addr添加到q的队尾;\\ &\}\\ \end{align}
            $$
        
            >   参数列表中每增加一个参数就添加一个参数地址至队列`q`中

